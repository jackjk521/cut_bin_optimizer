<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Printing Optimization Tool</title>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet" />
  </head>
  <body class="bg-gray-100 text-gray-900">
    <div class="container mx-auto py-8">
      <h1 class="text-3xl font-bold mb-6">Printing Optimization Calculator</h1>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="bg-white shadow-md rounded-lg p-6">
          <h2 class="text-xl font-bold mb-4">Input Parameters</h2>
          <form id="optimizationForm" class="space-y-4">
            <div>
              <label class="block">Client Width (in)</label>
              <input
                type="number"
                id="clientWidth"
                value="4"
                step="0.01"
                class="w-full border rounded px-2 py-1"
                required />
            </div>
            <div>
              <label class="block">Client Length (in)</label>
              <input
                type="number"
                id="clientLength"
                value="5.25"
                step="0.01"
                class="w-full border rounded px-2 py-1"
                required />
            </div>
            <div>
              <label class="block">Material Width (in)</label>
              <input
                type="number"
                id="materialWidth"
                value="28"
                step="0.01"
                class="w-full border rounded px-2 py-1"
                required />
            </div>
            <div>
              <label class="block">Material Length (in)</label>
              <input
                type="number"
                id="materialLength"
                value="34"
                step="0.01"
                class="w-full border rounded px-2 py-1"
                required />
            </div>
            <div>
              <label class="block">Machine Max Width (in)</label>
              <input
                type="number"
                id="machineMaxWidth"
                value="30"
                step="0.01"
                class="w-full border rounded px-2 py-1"
                required />
            </div>
            <div>
              <label class="block">Machine Max Length (in)</label>
              <input
                type="number"
                id="machineMaxLength"
                value="40"
                step="0.01"
                class="w-full border rounded px-2 py-1"
                required />
            </div>
            <div>
              <label class="block">Gutter (in)</label>
              <input
                type="number"
                id="gutter"
                value="0.25"
                step="0.01"
                class="w-full border rounded px-2 py-1"
                required />
            </div>
            <div>
              <label class="block">Bleed (in)</label>
              <input
                type="number"
                id="bleed"
                value="0.25"
                step="0.01"
                class="w-full border rounded px-2 py-1"
                required />
            </div>
            <div>
              <label class="block">Pull (in)</label>
              <input
                type="number"
                id="pull"
                value="0.25"
                step="0.01"
                class="w-full border rounded px-2 py-1"
                required />
            </div>
            <button
              type="submit"
              class="bg-blue-500 text-white py-1 px-4 rounded">
              Calculate
            </button>
          </form>
        </div>
        <div class="bg-white shadow-md rounded-lg p-6">
          <h2 class="text-xl font-bold mb-4">Results</h2>
          <div id="results" class="space-y-2"></div>
          <canvas
            id="visualization"
            class="border mt-4"
            width="500"
            height="500"></canvas>
        </div>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
      document
        .getElementById("optimizationForm")
        .addEventListener("submit", async function (event) {
          event.preventDefault();
          const params = {
            clientWidth: parseFloat(
              document.getElementById("clientWidth").value
            ),
            clientLength: parseFloat(
              document.getElementById("clientLength").value
            ),
            materialWidth: parseFloat(
              document.getElementById("materialWidth").value
            ),
            materialLength: parseFloat(
              document.getElementById("materialLength").value
            ),
            machineMaxWidth: parseFloat(
              document.getElementById("machineMaxWidth").value
            ),
            machineMaxLength: parseFloat(
              document.getElementById("machineMaxLength").value
            ),
            gutter: parseFloat(document.getElementById("gutter").value),
            bleed: parseFloat(document.getElementById("bleed").value),
            pull: parseFloat(document.getElementById("pull").value),
          };
          try {
            const response = await axios.post("/api/optimize", params);
            const ctx = document
              .getElementById("visualization")
              .getContext("2d");
            ctx.clearRect(0, 0, 500, 500);
            ctx.fillStyle = "#3498db";
            response.data.forEach((rect) => {
              ctx.fillRect(rect.x * 5, rect.y * 5, rect.w * 5, rect.h * 5);
            });
          } catch (error) {
            console.error(error);
            alert(error.response?.data?.error || "An error occurred");
          }
        });
    </script>
  </body>
</html>
